<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:mobi="http://java.sun.com/jsf/composite/mobi">

<ui:composition template="templates/template.xhtml">
    <f:metadata>
        <f:event type="preRenderView" listener="#{settingsDataProvider.init}"/>
        <f:event type="preRenderView" listener="#{environmentsDataProvider.loadContext}"/>
    </f:metadata>

    <ui:param name="screen" value="newSettings" />
    <ui:define name="title">Settings</ui:define>
    <ui:define name="pagetitle">
        <h:outputText id="pageheader" value="Settings" />
    </ui:define>
    <ui:define name="headerButtons">
        <a4j:commandLink value="Save" styleClass="btn primary right"
            rendered="#{securityDataProvider.hasPermission('SAVE_SETTINGS_ENV')}"
            action="#{environmentsDataProvider.save()}" render="environments"
            style="display: ${(param['mode']!='props' and param['mode']!='rolPerm' and param['mode']!='tags' and param['mode']!='functions' and param['mode']!='releases' and param['mode']!='appVersion') ? 'block' : 'none'}" />
    </ui:define>
    <ui:define name="body">
        <h:panelGroup layout="block" id="navig"
            rendered="#{securityDataProvider.hasPermission('SETTING_PANEL_LIST')}">
            <aside> <nav>
            <ul>
                <li
                    class="${settingsDataProvider.mode!='props' and settingsDataProvider.mode!='rolPerm' and settingsDataProvider.mode!='tags' and settingsDataProvider.mode!='functions' and settingsDataProvider.mode!='deployparam' and settingsDataProvider.mode!='releases' and settingsDataProvider.mode!='appVersion' ? 'current' : ''}">
                    <h:link value="Environments">
                        <f:param name="mode" value="envs" />
                    </h:link>
                </li>
                <li class="${settingsDataProvider.mode=='props' ? 'current' : ''}">
                    <h:outputLink value="/AMW_angular/#/settings/property-types">
                        Property Types
                    </h:outputLink>
                </li>
                <li class="${settingsDataProvider.mode=='tags' ? 'current' : ''}">
                    <h:outputLink value="/AMW_angular/#/settings/tags"
                                  rendered="#{securityDataProvider.hasPermission('ROLES_AND_PERMISSIONS_TAB')}">
                       Tags
                    </h:outputLink>
                </li>
                <li class="${settingsDataProvider.mode=='functions' ? 'current' : ''}">
                    <h:link value="Functions">
                        <f:param name="mode" value="functions" />
                    </h:link>
                </li>
                <li class="${settingsDataProvider.mode=='deployparam' ? 'current' : ''}">
                    <h:outputLink value="/AMW_angular/#/settings/deployment-parameter">
                        Deployment Parameter
                    </h:outputLink>
                </li>
                <li class="${settingsDataProvider.mode== 'releases' ? 'current' : ''}">
                    <h:outputLink value="/AMW_angular/#/settings/releases"
                                  rendered="#{securityDataProvider.hasPermission('RELEASE')}">
                        Releases
                    </h:outputLink>
                </li>
                <li class="${settingsDataProvider.mode=='rolePerm' ? 'current': ''}">
                    <h:outputLink value="/AMW_angular/#/settings/permission/role"
                                  rendered="#{securityDataProvider.hasPermission('ROLES_AND_PERMISSIONS_TAB')}">
                        Roles and Permissions
                    </h:outputLink>
                </li>
                <li class="${settingsDataProvider.mode=='appVersion' ? 'current': ''}">
                    <h:outputLink value="/AMW_angular/#/settings/application-info"
                                  rendered="#{securityDataProvider.hasPermission('RELEASE','READ')}">
                        Application Info
                    </h:outputLink>
                </li>
            </ul>
            </nav>
            </aside>
        </h:panelGroup>
        <section id="content">
        <div class="container">
            <h:form>
                <h:panelGroup
                    rendered="${settingsDataProvider.mode!='props' and settingsDataProvider.mode!='rolPerm' and settingsDataProvider.mode!='tags' and settingsDataProvider.mode!='functions' and settingsDataProvider.mode!='deployparam' and settingsDataProvider.mode!='releases' and settingsDataProvider.mode!='appVersion'}">
                    <h:panelGroup id="environments">
                        <div class="well">
                            <h2>Environments</h2>
                            <hr />
                            <table class="width100">
                                <tr>
                                    <td class="width120px vtop valignTop">
                                        <div class="marginLeft50">
                                            <ui:include src="components/contextTreeComp.xhtml" />
                                        </div>
                                    </td>
                                    <td valign="top" width="100%"><h:panelGroup id="content">
                                            <f:facet name="header">
                                                <h:outputText id="contentPanelHeader"
                                                    value="Selected context: #{contextDataProvider.contextDisplayName}" />
                                            </f:facet>
                                            <span class="right displayBlock">
                                                <h:commandLink id="addDomainOrEnvBtn"
                                                               styleClass="btn light" type="button"
                                                               rendered="#{!environmentsDataProvider.isEnv and securityDataProvider.hasPermission('ADD_NEW_ENV_OR_DOM')}"
                                                               value="Add new #{environmentsDataProvider.nameOfChildContext}"
                                                               onclick="#{rich:component('addContextPopupPanel')}.show();">
                                                </h:commandLink>
                                                <h:commandLink id="removeDomainOrEnvBtn"
                                                               styleClass="btn light"
                                                               rendered="#{!contextDataProvider.isGlobal and securityDataProvider.hasPermission('REMOVE_ENV_OR_DOM')}"
                                                               value="Remove #{environmentsDataProvider.contextTypeName} #{contextDataProvider.contextDisplayName}"
                                                               onclick="#{rich:component('confirmContextDeletePopupPanel')}.show();">
                                                </h:commandLink>
                                            </span>

                                            <div class="control-group">
                                                <label class="control-label">
                                                    <h:outputText value="#{environmentsDataProvider.contextTypeName} name" />
                                                </label>
                                                <div class="controls">
                                                    <h:inputText id="envOrDomainNameInput"
                                                        disabled="${contextDataProvider.isGlobal or securityDataProvider.hasPermission('EDIT_ENV_OR_DOM_NAME')==false}"
                                                        value="#{contextDataProvider.contextDisplayName}" />
                                                </div>

                                                <h:panelGroup rendered="${!contextDataProvider.isGlobal}">
                                                <label class="control-label">
                                                    <h:outputText value="#{environmentsDataProvider.contextTypeName} alias" />
                                                </label>
                                                <div class="controls">
                                                    <h:inputText id="envOrDomainNameAliasInput"
                                                         disabled="${contextDataProvider.isGlobal or securityDataProvider.hasPermission('EDIT_ENV_OR_DOM_NAME')==false}"
                                                         value="#{contextDataProvider.contextNameAlias}" />
                                                </div>
                                                </h:panelGroup>
                                            </div>
                                        </h:panelGroup></td>
                                </tr>
                            </table>
                        </div>
                    </h:panelGroup>
                </h:panelGroup>
            </h:form>

            <!-- Functions -->
            <h:panelGroup rendered="${settingsDataProvider.mode=='functions'}">
                <mobi:listGlobalFunctions/>
            </h:panelGroup>
        </div>
        </section>
    </ui:define>
    <ui:define name="component_popups">
        <rich:popupPanel id="addContextPopupPanel" autosized="true"
            movable="true" onshow="#{rich:element('contextName')}.focus();">
            <f:facet name="header">
                <h2>
                    <h:outputText
                        value="Create new #{environmentsDataProvider.nameOfChildContext} for #{contextDataProvider.contextDisplayName}"
                        id="addContextPopupPanelHeader" />
                </h2>
            </f:facet>
            <f:facet name="controls">
                <h:outputLink value="#"
                    styleClass="close icon icon-close icon-replace"
                    onclick="#{rich:component('addContextPopupPanel')}.hide(); return false;">
                    x
                    </h:outputLink>
            </f:facet>
            <h:form>
                <h:panelGroup id="addContextPopupPanelGroup">
                    <div class="control-group">
                        <label class="control-label"> <h:outputLabel value="Name" /></label>
                        <div class="controls">
                            <h:inputText id="contextName"
                                value="#{environmentsDataProvider.newName}" />
                        </div>
                        <a4j:commandLink id="createCtxButton"
                            value="OK"
                            styleClass="btn primary right"
                            render="environments"
                            action="#{environmentsDataProvider.createContext()}"
                            oncomplete="#{rich:component('addContextPopupPanel')}.hide(); return false;" />
                    </div>
                </h:panelGroup>

            </h:form>
        </rich:popupPanel>

        <rich:popupPanel id="confirmContextDeletePopupPanel" autosized="true">
            <f:facet name="header">
                <h2>
                    <h:outputText value="Remove context" />
                </h2>
            </f:facet>
            <f:facet name="controls">
                <h:outputLink value="#"
                    styleClass="close icon icon-close icon-replace"
                    onclick="#{rich:component('confirmContextDeletePopupPanel')}.hide(); return false;">
                    x
                    </h:outputLink>
            </f:facet>
            <h:panelGrid styleClass="marginBottom10">Are you sure you want to delete this context? <br />If you continue, all defined property values for any application, resource or relation between them as well as any sub context will be lost.</h:panelGrid>
            <h:form>
                <a4j:commandLink value="Delete" styleClass="btn primary right"
                    render="environments"
                    action="#{environmentsDataProvider.removeContext()}"
                    oncomplete="#{rich:component('confirmContextDeletePopupPanel')}.hide(); return false;" />

            </h:form>
        </rich:popupPanel>

        <h:form id="createPropertyTypeForm">
            <mobi:createPropertyTypePopup/>
        </h:form>

        <h:form id="deletePropertyTypeForm">
            <mobi:deletePropertyTypePopup/>
        </h:form>

    </ui:define>
</ui:composition>

</html>
